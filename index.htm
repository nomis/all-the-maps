<!DOCTYPE html>
<!--
	all-the-maps - Links to all the map services for a latitude/longitude location
	Copyright 2023  Simon Arlott

	This program is free software: you can redistribute it and/or modify
	it under the terms of the GNU Affero General Public License as published by
	the Free Software Foundation, either version 3 of the License, or
	(at your option) any later version.

	This program is distributed in the hope that it will be useful,
	but WITHOUT ANY WARRANTY; without even the implied warranty of
	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
	GNU Affero General Public License for more details.

	You should have received a copy of the GNU Affero General Public License
	along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<html>
	<head>
		<title id="title">All The Maps</title>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
		<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20100%20100%22%3E%3Ctext%20y%3D%22.9em%22%20font-size%3D%2290%22%3E%F0%9F%97%BA%EF%B8%8F%3C%2Ftext%3E%3C%2Fsvg%3E" />
		<style type="text/css">
		.page, .page:target ~ .default-page { display: none; }
		.default-page, .page:target { display: block; }
		#location h1, #location p { display: inline; font-size: medium; }
		nav ul { list-style-type: none; margin: 0; padding: 0; }
		nav ul li { display: inline; }
		nav a { display: inline-block; padding: 1ex; margin: 1ex; border: 1px solid; border-radius: 1ex; text-align: center; }
		input { font-size: large; }
		</style>
	</head>
	<body>
		<noscript>I don't like JavaScript either but it's the only way to get your location and avoid transmitting locations to the webserver.</noscript>

		<div id="find" class="page">
			<h1>Find me</h1>
			<p>Not implemented</p>
			<nav>
				<ul>
					<li><a href="#">Enter location</a></li>
				</ul>
			</nav>
		</div>

		<div id="location" class="page">
			<h1>Location</h1>
			<p><span id="lat_long">0, 0</span></p>
			<nav>
				<ul>
					<li><a id="osm"><img height="96px" src="/Openstreetmap_logo.svg" alt="OpenStreetMap"></a></li>
					<li><a id="android"><img height="96px" src="/Android_robot.svg" alt="Android App"></a></li>
					<li><a id="google"><img width="96px" src="/Google_Maps_logo_2020.svg" alt="Google Maps"></a></li>
					<li><a id="apple"><img height="48px" src="/Apple_Maps_logo.svg" alt="Apple Maps"></a></li>
					<li><a id="geohack"><img height="96px" src="/Wikimedia-logo.svg" alt="WikiMedia GeoHack"><br>GeoHack</a></li>
					<hr>
					<li><a href="javascript:reset_location()">Change location</a></li>
					<li><a href="javascript:copy_location()"">Copy to clipboard</a></li>
				</ul>
			</nav>
		</div>

		<div id="start" class="page default-page">
			<h1>All The Maps</h1>
			<nav><h2><a href="/#find">Find me</a></h2></nav>
			<form action="javascript:goto_location()" onreset="javascript:focus_location()">
			<h2>Enter <label for="location">Location</label></h2>
				<input id="input" type="text" name="location" size="20"
					placeholder="latitude,longitude" autocomplete="on" autofocus required
					pattern="[^0-9-]*(-?[1-9]*[0-9]+(?:\.[0-9]+)?)[^0-9-]+(-?[1-9]*[0-9]+(?:\.[0-9]+)?)[^0-9]*">
				<input type="submit" value="Go">
				<br><br><br>
				<input type="reset" value="Clear">
			</form>
		</div>

		<script type="text/javascript">
		const any_lat_long = /[^0-9-]*(-?[1-9]*[0-9]+(?:\.[0-9]+)?)[^0-9-]+(-?[1-9]*[0-9]+(?:\.[0-9]+)?)[^0-9]*/;
		const strict_lat_long = /^#(-?[1-9]*[0-9]+(?:\.[0-9]+)?,-?[1-9]*[0-9]+(?:\.[0-9]+)?)$/;

		function goto_location() {
			var match = document.getElementById("input").value.match(any_lat_long);
			if (match) {
				window.location.hash = `${match[1]},${match[2]}`;
			}
		}

		function update_location() {
			if (window.location.search != "") {
				window.location.search = "";
			}

			var match = location.hash.match(/^#(-?[1-9]*[0-9]+(?:\.[0-9]+)?),(-?[1-9]*[0-9]+(?:\.[0-9]+)?)(?:@([2-9]|1[0-9]|2[01]))?$/);
			if (match) {
				var lat = match[1];
				var lon = match[2];
				var zoom = match[3];

				if (zoom == undefined) {
					zoom = "19";
				}

				document.getElementById("lat_long").innerText = `${lat}, ${lon}`;
				document.getElementById("input").value = `${lat},${lon}`;
				document.getElementById("start").style = "display: none;";
				document.getElementById("location").style = "display: block";
				document.getElementById("title").innerText = `All The Maps (${lat}, ${lon})`;

				document.getElementById("osm").href = `https://www.openstreetmap.org/?mlat=${lat}&mlon=${lon}&zoom=${zoom}&layers=M`;
				document.getElementById("android").href = `geo:0,0?z=${zoom}&q=${lat},${lon}`;
				document.getElementById("google").href = `https://www.google.com/maps?ll=${lat},${lon}&q=${lat},${lon}&t=m&z=${zoom}`;
				document.getElementById("apple").href = `https://maps.apple.com/?ll=${lat},${lon}&q=${lat},${lon}&t=m&z=${zoom}`;
				document.getElementById("geohack").href = `https://geohack.toolforge.org/geohack.php?language=en&params=${lat};${lon}_dim:1`;
			} else {
				document.getElementById("location").style = "";
				document.getElementById("start").style = "";
				document.getElementById("title").innerText = "All The Maps";

				focus_location();
			}
		}

		function reset_location() {
			window.location.hash = "";

			if (window.location.search != "") {
				window.location.search = "";
			}
		}

		function copy_location() {
			navigator.clipboard.writeText(window.location.href);
		}

		function focus_location() {
			document.getElementById("input").focus();
		}

		window.onload = update_location;
		window.onhashchange = update_location;
		</script>
	</body>
</html>
